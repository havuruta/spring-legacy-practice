<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.balanceeat.demo.domain.diet.mapper.DietMapper">
    <insert id="insertDiet" parameterType="com.balanceeat.demo.domain.diet.entity.Diet">
        INSERT INTO diets (
            user_id,
            diet_date,
            meal_type,
            food_name,
            amount,
            calories,
            protein,
            fat,
            carbohydrates,
            note,
            created_at,
            updated_at
        ) VALUES (
            #{userId},
            #{dietDate},
            #{mealType},
            #{foodName},
            #{amount},
            #{calories},
            #{protein},
            #{fat},
            #{carbohydrates},
            #{note},
            NOW(),
            NOW()
        )
    </insert>

    <select id="findDietsByDateRange" resultType="com.balanceeat.demo.domain.diet.entity.Diet">
        SELECT *
        FROM diets
        WHERE user_id = #{userId}
          AND diet_date BETWEEN #{start} AND #{end}
        ORDER BY diet_date DESC, meal_type
    </select>


    <update id="updateDiet" parameterType="com.balanceeat.demo.domain.diet.entity.Diet">
        UPDATE diets
        SET
            amount = #{amount},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

    <delete id="deleteDiet" parameterType="long">
        DELETE FROM diets WHERE id = #{id}
    </delete>

    <select id="findDietsByDate" resultType="com.balanceeat.demo.domain.diet.entity.Diet">
        SELECT 
            id,
            user_id as userId,
            diet_date as dietDate,
            meal_type as mealType,
            food_name as foodName,
            amount,
            calories,
            protein,
            fat,
            carbohydrates,
            note,
            created_at as createdAt,
            updated_at as updatedAt
        FROM diets
        WHERE user_id = #{userId}
        AND diet_date = #{date}
        ORDER BY meal_type, id
    </select>
</mapper> 